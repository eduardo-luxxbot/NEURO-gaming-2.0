
# Corrigindo o c√≥digo - problema de centraliza√ß√£o e agentes n√£o aparecendo

codigo_corrigido = '''<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURO: VERSE 2.0</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a0f;
            color: #e0e0ff;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            display: flex;
            height: 100vh;
        }
        #ui-lateral {
            width: 350px;
            background: linear-gradient(180deg, #0a0a12 0%, #1a1a2e 50%, #0f0f1a 100%);
            border-right: 3px solid #00d4ff;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 100;
        }
        .logo {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #2a2a4a;
        }
        .logo h1 {
            font-size: 28px;
            background: linear-gradient(90deg, #00d4ff, #7b2cbf, #ff006e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 4px;
        }
        .logo span {
            font-size: 12px;
            color: #7b2cbf;
            letter-spacing: 8px;
        }
        .secao {
            background: rgba(0,212,255,0.05);
            border: 1px solid #2a2a4a;
            border-radius: 12px;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }
        .secao::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #00d4ff, #7b2cbf);
        }
        .secao h3 {
            color: #00d4ff;
            font-size: 13px;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        .stat-card {
            background: rgba(0,0,0,0.3);
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #2a2a4a;
        }
        .stat-icon { font-size: 20px; margin-bottom: 5px; }
        .stat-label {
            font-size: 9px;
            color: #7b2cbf;
            text-transform: uppercase;
        }
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #00d4ff;
        }
        .btn-acao {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border: 2px solid #3a6bc9;
            color: white;
            padding: 12px 8px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 11px;
            text-transform: uppercase;
            transition: all 0.3s;
            width: 100%;
            margin: 5px 0;
        }
        .btn-acao:hover {
            transform: translateY(-2px);
            border-color: #00d4ff;
        }
        .btn-acao.ativo {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #0a0a0f;
            border-color: #00d4ff;
        }
        .btn-perigoso {
            background: linear-gradient(135deg, #721e1e 0%, #982a2a 100%);
            border-color: #c93a3a;
        }
        .info-mundo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            font-size: 11px;
        }
        .info-item {
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 6px;
            border-left: 3px solid #7b2cbf;
        }
        #log-eventos {
            height: 150px;
            overflow-y: auto;
            font-size: 11px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 10px;
        }
        .evento {
            padding: 6px;
            margin-bottom: 6px;
            border-radius: 6px;
            border-left: 3px solid;
            background: rgba(255,255,255,0.03);
        }
        .evento-guerra { border-left-color: #ff4444; }
        .evento-religiao { border-left-color: #ffaa00; }
        .evento-social { border-left-color: #00d4ff; }
        .evento-morte { border-left-color: #888; }
        #area-jogo {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: #050508;
        }
        #barra-superior {
            height: 60px;
            background: linear-gradient(90deg, #0f0f1a 0%, #1a1a2e 100%);
            border-bottom: 2px solid #2a2a4a;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 30px;
        }
        .indicador {
            text-align: center;
            padding: 0 20px;
        }
        .indicador-label {
            font-size: 10px;
            color: #7b2cbf;
            text-transform: uppercase;
        }
        .indicador-valor {
            font-size: 24px;
            font-weight: bold;
            color: #00d4ff;
        }
        #canvas-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
        }
        canvas {
            border: 2px solid #2a2a4a;
            box-shadow: 0 0 30px rgba(0,212,255,0.2);
            background: #0a0a0f;
        }
        #tooltip {
            position: absolute;
            background: rgba(10,10,15,0.95);
            border: 2px solid #00d4ff;
            border-radius: 8px;
            padding: 10px;
            font-size: 12px;
            pointer-events: none;
            display: none;
            z-index: 1000;
            max-width: 250px;
        }
        #painel-interacao {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10,10,15,0.95);
            border: 2px solid #7b2cbf;
            border-radius: 12px;
            padding: 15px;
            display: none;
            flex-direction: column;
            gap: 10px;
            min-width: 300px;
        }
        #legendas {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            border: 1px solid #2a2a4a;
            border-radius: 8px;
            padding: 15px;
            font-size: 11px;
        }
        .legenda-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 6px 0;
        }
        .legenda-cor {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid;
        }
    </style>
</head>
<body>
    <div id="ui-lateral">
        <div class="logo">
            <h1>NEURO: VERSE</h1>
            <span>2.0</span>
        </div>
        <div class="secao">
            <h3>üë§ Seu Personagem</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">‚ù§Ô∏è</div>
                    <div class="stat-label">Sa√∫de</div>
                    <div class="stat-value" id="stat-saude">100%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-label">Energia</div>
                    <div class="stat-value" id="stat-energia">100%</div>
                </div>
            </div>
        </div>
        <div class="secao">
            <h3>üéÆ Modo de A√ß√£o</h3>
            <button class="btn-acao ativo" onclick="jogo.setModo('observar')" id="btn-observar">üëÅÔ∏è Observar</button>
            <button class="btn-acao" onclick="jogo.setModo('mover')" id="btn-mover">üö∂ Mover</button>
            <button class="btn-acao" onclick="jogo.setModo('interagir')" id="btn-interagir">ü§ù Interagir</button>
            <button class="btn-acao btn-perigoso" onclick="jogo.setModo('atacar')" id="btn-atacar">‚öîÔ∏è Atacar</button>
        </div>
        <div class="secao">
            <h3>üåç Estado do Mundo</h3>
            <div class="info-mundo">
                <div class="info-item">
                    <div>Popula√ß√£o</div>
                    <div style="color:#00d4ff; font-weight:bold;" id="info-pop">40</div>
                </div>
                <div class="info-item">
                    <div>Fac√ß√µes</div>
                    <div style="color:#00d4ff; font-weight:bold;" id="info-fac">0</div>
                </div>
                <div class="info-item">
                    <div>Religi√µes</div>
                    <div style="color:#00d4ff; font-weight:bold;" id="info-rel">0</div>
                </div>
                <div class="info-item">
                    <div>Turno</div>
                    <div style="color:#00d4ff; font-weight:bold;" id="info-turno">0</div>
                </div>
            </div>
        </div>
        <div class="secao">
            <h3>‚è±Ô∏è Controles</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px;">
                <button class="btn-acao" onclick="jogo.pausar()" id="btn-pausa">‚è∏Ô∏è Pausar</button>
                <button class="btn-acao" onclick="jogo.umTurno()">‚è≠Ô∏è 1 Turno</button>
            </div>
        </div>
        <div class="secao">
            <h3>üìú Cr√¥nicas</h3>
            <div id="log-eventos">
                <div style="color:#666; font-style:italic;">O mundo desperta...</div>
            </div>
        </div>
    </div>
    <div id="area-jogo">
        <div id="barra-superior">
            <div class="indicador">
                <div class="indicador-label">Turno</div>
                <div class="indicador-valor" id="ind-turno">0</div>
            </div>
            <div class="indicador">
                <div class="indicador-label">Sobreviventes</div>
                <div class="indicador-valor" id="ind-pop">40</div>
            </div>
        </div>
        <div id="canvas-container">
            <canvas id="gameCanvas" width="700" height="700"></canvas>
            <div id="tooltip"></div>
            <div id="painel-interacao">
                <h4 id="painel-titulo" style="color:#7b2cbf; text-align:center; margin-bottom:10px;">Agente</h4>
                <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px;">
                    <button class="btn-acao" onclick="jogo.acaoAgente('conversar')" style="padding:8px; font-size:10px;">üí¨ Conversar</button>
                    <button class="btn-acao" onclick="jogo.acaoAgente('dar_comida')" style="padding:8px; font-size:10px;">üçû Dar Comida</button>
                    <button class="btn-acao btn-perigoso" onclick="jogo.acaoAgente('atacar')" style="padding:8px; font-size:10px;">‚öîÔ∏è Atacar</button>
                </div>
                <button class="btn-acao" onclick="jogo.fecharPainel()" style="margin-top:8px;">‚ùå Fechar</button>
            </div>
            <div id="legendas">
                <div style="font-weight:bold; margin-bottom:10px; color:#00d4ff;">Profiss√µes</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#44ff44; border-color:#44ff44;"></div> Agricultor üåæ</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#ff4444; border-color:#ff4444;"></div> Guerreiro ‚öîÔ∏è</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#ffaa00; border-color:#ffaa00;"></div> Mercador üí∞</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#4488ff; border-color:#4488ff;"></div> Artes√£o üî®</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#aa44ff; border-color:#aa44ff;"></div> S√°bio üìú</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#888888; border-color:#888888;"></div> Ladr√£o üó°Ô∏è</div>
                <div style="margin-top:15px; font-weight:bold; color:#00d4ff;">Voc√™</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#00d4ff; border-color:#00d4ff;"></div> Viajante üß≠</div>
            </div>
        </div>
    </div>

<script>
class Agente {
    constructor(dados) {
        this.id = dados.id;
        this.nome = dados.nome;
        this.x = dados.x;
        this.y = dados.y;
        this.profissao = dados.profissao;
        this.bioma = dados.bioma;
        this.vivo = dados.vivo;
        this.saude = dados.saude;
        this.energia = dados.energia;
        this.fome = dados.fome || 0;
        this.faccao = dados.faccao;
        this.religiao = dados.religiao;
        this.humor = dados.humor || 'neutro';
        this.cores = {
            'agricultor': '#44ff44', 'guerreiro': '#ff4444', 'mercador': '#ffaa00',
            'artesao': '#4488ff', 'sabio': '#aa44ff', 'ladrao': '#888888', 'viajante': '#00d4ff'
        };
        this.icones = {
            'agricultor': 'üåæ', 'guerreiro': '‚öîÔ∏è', 'mercador': 'üí∞',
            'artesao': 'üî®', 'sabio': 'üìú', 'ladrao': 'üó°Ô∏è', 'viajante': 'üß≠'
        };
    }
    
    desenhar(ctx, tamanhoCell, selecionado) {
        if (!this.vivo) return;
        
        const px = this.x * tamanhoCell + tamanhoCell/2;
        const py = this.y * tamanhoCell + tamanhoCell/2;
        const raio = tamanhoCell * 0.35;
        
        // Aura se selecionado
        if (selecionado) {
            ctx.beginPath();
            ctx.arc(px, py, raio + 10, 0, Math.PI * 2);
            ctx.fillStyle = 'rgba(0,212,255,0.4)';
            ctx.fill();
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 3;
            ctx.stroke();
        }
        
        // Aura baseada no humor
        const auras = {
            'alegria': 'rgba(255,221,0,0.4)',
            'raiva': 'rgba(255,0,0,0.4)',
            'medo': 'rgba(136,0,255,0.4)',
            'neutro': 'rgba(136,136,136,0.2)'
        };
        ctx.beginPath();
        ctx.arc(px, py, raio + 6, 0, Math.PI * 2);
        ctx.fillStyle = auras[this.humor] || auras['neutro'];
        ctx.fill();
        
        // Corpo
        ctx.beginPath();
        ctx.arc(px, py, raio, 0, Math.PI * 2);
        ctx.fillStyle = this.cores[this.profissao] || '#ffffff';
        ctx.fill();
        
        // Borda por sa√∫de
        ctx.strokeStyle = this.saude > 0.7 ? '#44ff44' : this.saude > 0.4 ? '#ffaa00' : '#ff4444';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        // Indicador de fac√ß√£o
        if (this.faccao) {
            ctx.beginPath();
            ctx.arc(px + raio*0.6, py - raio*0.6, 5, 0, Math.PI * 2);
            ctx.fillStyle = '#ffffff';
            ctx.fill();
        }
        
        // Indicador de religi√£o
        if (this.religiao) {
            ctx.beginPath();
            ctx.arc(px - raio*0.6, py - raio*0.6, 4, 0, Math.PI * 2);
            ctx.fillStyle = '#ffdd00';
            ctx.fill();
        }
        
        // √çcone
        ctx.font = `${tamanhoCell * 0.5}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(this.icones[this.profissao] || 'üë§', px, py);
        
        // Nome
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 11px Arial';
        ctx.textAlign = 'center';
        ctx.fillText(this.nome, px, py - raio - 15);
    }
}

class Jogo {
    constructor() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.tamanhoGrid = 20;
        this.tamanhoCell = 35;
        this.agentes = [];
        this.jogador = null;
        this.agenteSelecionado = null;
        this.modo = 'observar';
        this.turno = 0;
        this.pausado = false;
        this.faccoes = [];
        this.religioes = [];
        this.biomas = this.gerarBiomas();
        this.gerarAgentes(35);
        this.inicializar();
    }
    
    gerarBiomas() {
        const biomas = [];
        for (let y = 0; y < this.tamanhoGrid; y++) {
            for (let x = 0; x < this.tamanhoGrid; x++) {
                let tipo = 'planicie';
                let cor = '#3d5c3d';
                if (x < 10 && y < 10) { tipo = 'floresta'; cor = '#2d5016'; }
                else if (x >= 10 && y < 10) { tipo = 'deserto'; cor = '#c2b280'; }
                else if (x < 10 && y >= 10) { tipo = 'montanha'; cor = '#4a4a4a'; }
                biomas.push({x, y, tipo, cor});
            }
        }
        return biomas;
    }
    
    gerarAgentes(quantidade) {
        const nomes = ['Aria','Kael','Mira','Thorn','Luna','Sol','Nyx','Orion','Vesper','Dawn',
                      'Ash','Ember','River','Stone','Sky','Flame','Shadow','Light','Storm','Calm',
                      'Zephyr','Frost','Iron','Gold','Silver','Copper','Lead','Mercury','Sulfur','Salt',
                      'Echo','Silence','Noise','Music','Rhythm','Blues','Jazz','Rock','Pop','Folk'];
        const profissoes = ['agricultor','guerreiro','mercador','artesao','sabio','ladrao'];
        
        for (let i = 0; i < quantidade; i++) {
            const x = Math.floor(Math.random() * this.tamanhoGrid);
            const y = Math.floor(Math.random() * this.tamanhoGrid);
            const bioma = this.biomas.find(b => b.x === x && b.y === y);
            
            let prof = profissoes[Math.floor(Math.random() * profissoes.length)];
            if (bioma.tipo === 'floresta' && Math.random() < 0.6) prof = 'agricultor';
            else if (bioma.tipo === 'deserto' && Math.random() < 0.5) prof = Math.random() < 0.5 ? 'mercador' : 'guerreiro';
            else if (bioma.tipo === 'montanha' && Math.random() < 0.5) prof = Math.random() < 0.5 ? 'artesao' : 'guerreiro';
            
            this.agentes.push(new Agente({
                id: `NPC_${i}`,
                nome: nomes[i % nomes.length],
                x: x, y: y,
                profissao: prof,
                bioma: bioma.tipo,
                vivo: true,
                saude: 0.7 + Math.random() * 0.3,
                energia: 0.6 + Math.random() * 0.4,
                fome: Math.random() * 0.3,
                faccao: null,
                religiao: null,
                humor: ['alegria','raiva','medo','neutro'][Math.floor(Math.random() * 4)]
            }));
        }
        
        this.jogador = new Agente({
            id: 'JOGADOR',
            nome: 'Voc√™',
            x: 10, y: 10,
            profissao: 'viajante',
            bioma: 'planicie',
            vivo: true,
            saude: 1.0,
            energia: 1.0,
            fome: 0,
            faccao: null,
            religiao: null,
            humor: 'curiosidade'
        });
        this.agentes.push(this.jogador);
        this.atualizarUI();
    }
    
    desenhar() {
        // Fundo
        this.ctx.fillStyle = '#0a0a0f';
        this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Biomas
        for (let bioma of this.biomas) {
            this.ctx.fillStyle = bioma.cor;
            this.ctx.globalAlpha = 0.4;
            this.ctx.fillRect(bioma.x * this.tamanhoCell, bioma.y * this.tamanhoCell, this.tamanhoCell, this.tamanhoCell);
        }
        this.ctx.globalAlpha = 1;
        
        // Grid
        this.ctx.strokeStyle = 'rgba(255,255,255,0.08)';
        this.ctx.lineWidth = 1;
        for (let i = 0; i <= this.tamanhoGrid; i++) {
            this.ctx.beginPath();
            this.ctx.moveTo(i * this.tamanhoCell, 0);
            this.ctx.lineTo(i * this.tamanhoCell, this.canvas.height);
            this.ctx.stroke();
            this.ctx.beginPath();
            this.ctx.moveTo(0, i * this.tamanhoCell);
            this.ctx.lineTo(this.canvas.width, i * this.tamanhoCell);
            this.ctx.stroke();
        }
        
        // Agentes
        for (let agente of this.agentes) {
            agente.desenhar(this.ctx, this.tamanhoCell, agente === this.jogador);
        }
    }
    
    simularTurno() {
        if (this.pausado) return;
        this.turno++;
        let eventosTurno = 0;
        
        for (let agente of this.agentes) {
            if (!agente.vivo || agente.id === 'JOGADOR') continue;
            
            // Movimento
            if (Math.random() < 0.3) {
                const dx = Math.floor(Math.random() * 3) - 1;
                const dy = Math.floor(Math.random() * 3) - 1;
                agente.x = Math.max(0, Math.min(this.tamanhoGrid-1, agente.x + dx));
                agente.y = Math.max(0, Math.min(this.tamanhoGrid-1, agente.y + dy));
                const novoBioma = this.biomas.find(b => b.x === agente.x && b.y === agente.y);
                if (novoBioma) agente.bioma = novoBioma.tipo;
            }
            
            // Mudar humor
            if (Math.random() < 0.1) {
                agente.humor = ['alegria','raiva','medo','neutro'][Math.floor(Math.random() * 4)];
            }
            
            // Fome e sa√∫de
            agente.fome += 0.02;
            agente.energia -= 0.01;
            if (agente.fome > 0.7) agente.saude -= 0.02;
            
            // Morte
            if (agente.saude <= 0) {
                agente.vivo = false;
                this.logEvento('morte', `${agente.nome} faleceu.`);
                eventosTurno++;
            }
            
            // Formar fac√ß√£o
            if (!agente.faccao && Math.random() < 0.02) {
                const aliado = this.agentes.find(a => 
                    a.vivo && a.id !== agente.id && !a.faccao && 
                    Math.abs(a.x - agente.x) <= 2 && Math.abs(a.y - agente.y) <= 2
                );
                if (aliado) {
                    const nomeFaccao = `Ordem_${agente.nome}`;
                    agente.faccao = nomeFaccao;
                    aliado.faccao = nomeFaccao;
                    this.faccoes.push(nomeFaccao);
                    this.logEvento('social', `${nomeFaccao} fundada por ${agente.nome} e ${aliado.nome}!`);
                    eventosTurno++;
                }
            }
            
            // Religi√£o
            if (Math.random() < 0.005 && !agente.religiao) {
                const deuses = ['Sol','Lua','Terra','Fogo','√Ågua'];
                const deus = deuses[Math.floor(Math.random() * deuses.length)];
                agente.religiao = deus;
                if (!this.religioes.includes(deus)) {
                    this.religioes.push(deus);
                    this.logEvento('religiao', `${agente.nome} teve vis√£o de ${deus}!`);
                    eventosTurno++;
                }
            }
        }
        
        if (Math.random() < 0.03) {
            const eventos = ['Colheita abundante!', 'Seca no deserto!', 'Bandidos atacam!'];
            this.logEvento('economia', eventos[Math.floor(Math.random() * eventos.length)]);
        }
        
        this.atualizarUI();
        this.desenhar();
    }
    
    logEvento(tipo, mensagem) {
        const cores = {guerra: '#ff4444', religiao: '#ffaa00', social: '#00d4ff', economia: '#44ff44', morte: '#888888'};
        const log = document.getElementById('log-eventos');
        const div = document.createElement('div');
        div.className = `evento evento-${tipo}`;
        div.innerHTML = `<strong style="color:${cores[tipo] || '#fff'}">[T${this.turno}]</strong> ${mensagem}`;
        log.insertBefore(div, log.firstChild);
        if (log.children.length > 15) log.removeChild(log.lastChild);
    }
    
    atualizarUI() {
        const vivos = this.agentes.filter(a => a.vivo).length;
        document.getElementById('info-pop').textContent = vivos;
        document.getElementById('info-fac').textContent = new Set(this.agentes.map(a => a.faccao).filter(f => f)).size;
        document.getElementById('info-rel').textContent = this.religioes.length;
        document.getElementById('info-turno').textContent = this.turno;
        document.getElementById('ind-turno').textContent = this.turno;
        document.getElementById('ind-pop').textContent = vivos;
        
        if (this.jogador) {
            document.getElementById('stat-saude').textContent = Math.floor(this.jogador.saude * 100) + '%';
            document.getElementById('stat-energia').textContent = Math.floor(this.jogador.energia * 100) + '%';
        }
    }
    
    inicializar() {
        this.desenhar();
        setInterval(() => this.simularTurno(), 1000);
        
        // Clique no canvas
        this.canvas.addEventListener('click', (e) => {
            const rect = this.canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / this.tamanhoCell);
            const y = Math.floor((e.clientY - rect.top) / this.tamanhoCell);
            
            if (this.modo === 'mover') {
                this.jogador.x = x;
                this.jogador.y = y;
                this.desenhar();
                return;
            }
            
            const agente = this.agentes.find(a => a.vivo && a.x === x && a.y === y);
            if (agente && agente.id !== 'JOGADOR') {
                if (this.modo === 'atacar') {
                    this.atacarAgente(agente);
                } else {
                    this.selecionarAgente(agente);
                }
            }
        });
        
        // Mouse move para tooltip
        this.canvas.addEventListener('mousemove', (e) => {
            const rect = this.canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / this.tamanhoCell);
            const y = Math.floor((e.clientY - rect.top) / this.tamanhoCell);
            
            const agente = this.agentes.find(a => a.vivo && a.x === x && a.y === y);
            const tooltip = document.getElementById('tooltip');
            
            if (agente) {
                tooltip.style.display = 'block';
                tooltip.style.left = (e.clientX + 15) + 'px';
                tooltip.style.top = (e.clientY + 15) + 'px';
                tooltip.innerHTML = `
                    <strong style="color:#00d4ff; font-size:14px;">${agente.icones[agente.profissao]} ${agente.nome}</strong><br>
                    <span style="color:#888;">Profiss√£o:</span> <span style="color:${agente.cores[agente.profissao]}">${agente.profissao}</span><br>
                    <span style="color:#888;">Sa√∫de:</span> <span style="color:${agente.saude > 0.7 ? '#44ff44' : agente.saude > 0.4 ? '#ffaa00' : '#ff4444'}">${Math.floor(agente.saude * 100)}%</span><br>
                    <span style="color:#888;">Humor:</span> ${agente.humor}<br>
                    ${agente.faccao ? `<span style="color:#888;">Fac√ß√£o:</span> ${agente.faccao}<br>` : ''}
                    ${agente.religiao ? `<span style="color:#888;">Religi√£o:</span> <span style="color:#ffdd00">${agente.religiao}</span>` : ''}
                `;
            } else {
                tooltip.style.display = 'none';
            }
        });
    }
    
    setModo(modo) {
        this.modo = modo;
        document.querySelectorAll('.btn-acao').forEach(btn => btn.classList.remove('ativo'));
        document.getElementById(`btn-${modo}`).classList.add('ativo');
    }
    
    pausar() {
        this.pausado = !this.pausado;
        document.getElementById('btn-pausa').innerHTML = this.pausado ? '‚ñ∂Ô∏è Continuar' : '‚è∏Ô∏è Pausar';
    }
    
    umTurno() {
        const eraPausado = this.pausado;
        this.pausado = false;
        this.simularTurno();
        this.pausado = eraPausado;
    }
    
    selecionarAgente(agente) {
        this.agenteSelecionado = agente;
        document.getElementById('painel-titulo').textContent = `${agente.icones[agente.profissao]} ${agente.nome}`;
        document.getElementById('painel-interacao').style.display = 'flex';
    }
    
    fecharPainel() {
        document.getElementById('painel-interacao').style.display = 'none';
        this.agenteSelecionado = null;
    }
    
    acaoAgente(acao) {
        if (!this.agenteSelecionado) return;
        const alvo = this.agenteSelecionado;
        
        switch(acao) {
            case 'conversar':
                alvo.humor = 'alegria';
                this.logEvento('social', `Voc√™ conversou com ${alvo.nome}.`);
                break;
            case 'dar_comida':
                alvo.fome = Math.max(0, alvo.fome - 0.3);
                alvo.humor = 'alegria';
                this.logEvento('social', `Voc√™ deu comida para ${alvo.nome}.`);
                break;
            case 'atacar':
                this.atacarAgente(alvo);
                return;
        }
        
        this.fecharPainel();
        this.atualizarUI();
        this.desenhar();
    }
    
    atacarAgente(alvo) {
        alvo.saude -= 0.4;
        alvo.humor = 'raiva';
        this.logEvento('guerra', `Voc√™ atacou ${alvo.nome}!`);
        
        if (alvo.saude <= 0) {
            alvo.vivo = false;
            this.logEvento('morte', `${alvo.nome} foi morto por voc√™!`);
            const amigos = this.agentes.filter(a => a.vivo && a.faccao === alvo.faccao && a.id !== alvo.id);
            for (let amigo of amigos) amigo.humor = 'raiva';
            if (amigos.length > 0) this.logEvento('guerra', `Aliados de ${alvo.nome} est√£o furiosos!`);
        }
        
        this.fecharPainel();
        this.atualizarUI();
        this.desenhar();
    }
}

const jogo = new Jogo();
</script>
</body>
</html>'''
