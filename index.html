<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEURO: VERSE 3.0 - Ultimate Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --neon-blue: #00d4ff;
            --neon-purple: #7b2cbf;
            --neon-pink: #ff006e;
            --neon-green: #44ff44;
            --neon-red: #ff4444;
            --dark-bg: #050508;
            --panel-bg: rgba(10, 10, 15, 0.95);
        }
        
        body {
            background: var(--dark-bg);
            color: #e0e0ff;
            font-family: 'Rajdhani', sans-serif;
            overflow: hidden;
            display: flex;
            height: 100vh;
        }
        
        #ui-lateral {
            width: 380px;
            background: linear-gradient(180deg, rgba(10,10,18,0.98) 0%, rgba(20,20,35,0.95) 100%);
            border-right: 3px solid var(--neon-blue);
            box-shadow: 0 0 50px rgba(0,212,255,0.3);
            padding: 25px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .logo {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(0,212,255,0.05);
            border: 1px solid rgba(0,212,255,0.2);
            border-radius: 15px;
        }
        
        .logo h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 6px;
        }
        
        .logo span {
            font-family: 'Orbitron', sans-serif;
            font-size: 14px;
            color: var(--neon-purple);
            letter-spacing: 10px;
            display: block;
            margin-top: 5px;
        }
        
        .secao {
            background: var(--panel-bg);
            border: 1px solid rgba(0,212,255,0.2);
            border-radius: 15px;
            padding: 20px;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .secao:hover {
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0,212,255,0.2);
        }
        
        .secao::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--neon-blue), var(--neon-purple));
        }
        
        .secao h3 {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-blue);
            font-size: 14px;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,212,255,0.1));
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(0,212,255,0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--neon-blue);
            box-shadow: 0 10px 30px rgba(0,212,255,0.3);
        }
        
        .stat-icon { font-size: 28px; margin-bottom: 8px; }
        
        .stat-label {
            font-size: 10px;
            color: var(--neon-purple);
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 700;
        }
        
        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 22px;
            font-weight: 700;
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0,212,255,0.5);
        }
        
        .barra-container { margin: 12px 0; }
        
        .barra-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 6px;
            display: flex;
            justify-content: space-between;
        }
        
        .barra-fundo {
            background: rgba(0,0,0,0.5);
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .barra-preenchimento {
            height: 100%;
            border-radius: 6px;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .barra-vida { background: linear-gradient(90deg, #ff2244, #ff4466); }
        .barra-energia { background: linear-gradient(90deg, #ffaa00, #ffcc00); }
        .barra-fome { background: linear-gradient(90deg, #44ff44, #66ff66); }
        
        .btn-acao {
            background: linear-gradient(135deg, rgba(30,60,114,0.8), rgba(42,82,152,0.8));
            border: 2px solid rgba(0,212,255,0.3);
            color: white;
            padding: 14px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 2px;
            transition: all 0.3s ease;
            width: 100%;
            margin: 6px 0;
        }
        
        .btn-acao:hover {
            transform: translateY(-3px);
            border-color: var(--neon-blue);
            box-shadow: 0 10px 30px rgba(0,212,255,0.4);
        }
        
        .btn-acao.ativo {
            background: linear-gradient(135deg, var(--neon-blue), #0099cc);
            color: #000;
            border-color: var(--neon-blue);
            box-shadow: 0 0 30px rgba(0,212,255,0.6);
        }
        
        .btn-perigoso {
            background: linear-gradient(135deg, rgba(114,30,30,0.8), rgba(152,42,42,0.8));
            border-color: rgba(255,68,68,0.3);
        }
        
        .btn-perigoso:hover {
            border-color: var(--neon-red);
            box-shadow: 0 10px 30px rgba(255,0,0,0.4);
        }
        
        #area-jogo {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            background: radial-gradient(ellipse at center, #0a0a15 0%, #050508 100%);
        }
        
        #barra-superior {
            height: 80px;
            background: linear-gradient(90deg, rgba(15,15,26,0.95), rgba(26,26,46,0.95));
            border-bottom: 2px solid rgba(0,212,255,0.2);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 40px;
        }
        
        .indicador {
            text-align: center;
            padding: 0 30px;
        }
        
        .indicador-label {
            font-size: 11px;
            color: var(--neon-purple);
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 700;
        }
        
        .indicador-valor {
            font-family: 'Orbitron', sans-serif;
            font-size: 28px;
            font-weight: 900;
            color: var(--neon-blue);
            text-shadow: 0 0 20px rgba(0,212,255,0.6);
        }
        
        #canvas-container {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        
        canvas {
            border: 2px solid rgba(0,212,255,0.3);
            border-radius: 10px;
            box-shadow: 0 0 60px rgba(0,212,255,0.2);
            background: #0a0a0f;
        }
        
        #tooltip {
            position: absolute;
            background: linear-gradient(135deg, rgba(10,10,20,0.98), rgba(20,20,40,0.98));
            border: 2px solid var(--neon-blue);
            border-radius: 15px;
            padding: 20px;
            font-size: 13px;
            pointer-events: none;
            display: none;
            z-index: 1000;
            max-width: 300px;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }
        
        #painel-interacao {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(10,10,20,0.98), rgba(26,26,46,0.98));
            border: 2px solid var(--neon-purple);
            border-radius: 20px;
            padding: 25px;
            display: none;
            flex-direction: column;
            gap: 15px;
            min-width: 400px;
            backdrop-filter: blur(20px);
            box-shadow: 0 30px 80px rgba(0,0,0,0.8);
        }
        
        #painel-titulo {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-purple);
            text-align: center;
            font-size: 20px;
            text-shadow: 0 0 20px rgba(123,44,191,0.5);
        }
        
        .acoes-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        
        #legendas {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(0,0,0,0.9);
            border: 1px solid rgba(0,212,255,0.3);
            border-radius: 15px;
            padding: 20px;
            font-size: 12px;
            backdrop-filter: blur(10px);
        }
        
        .legenda-titulo {
            font-family: 'Orbitron', sans-serif;
            color: var(--neon-blue);
            margin-bottom: 15px;
            font-size: 14px;
            letter-spacing: 2px;
        }
        
        .legenda-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
        }
        
        .legenda-cor {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid;
            box-shadow: 0 0 10px currentColor;
        }
        
        #log-eventos {
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(0,212,255,0.1);
        }
        
        .evento {
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 8px;
            border-left: 4px solid;
            background: rgba(255,255,255,0.03);
            animation: eventIn 0.5s ease;
        }
        
        @keyframes eventIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .evento-guerra { border-left-color: var(--neon-red); background: linear-gradient(90deg, rgba(255,0,0,0.1), transparent); }
        .evento-religiao { border-left-color: #ffaa00; background: linear-gradient(90deg, rgba(255,170,0,0.1), transparent); }
        .evento-economia { border-left-color: var(--neon-green); background: linear-gradient(90deg, rgba(0,255,0,0.1), transparent); }
        .evento-social { border-left-color: var(--neon-blue); background: linear-gradient(90deg, rgba(0,212,255,0.1), transparent); }
        .evento-morte { border-left-color: #888; background: linear-gradient(90deg, rgba(100,100,100,0.2), transparent); }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb { background: linear-gradient(180deg, var(--neon-blue), var(--neon-purple)); border-radius: 4px; }
    </style>
</head>
<body>
    <div id="ui-lateral">
        <div class="logo">
            <h1>NEURO: VERSE</h1>
            <span>3.0 ULTIMATE</span>
        </div>
        
        <div class="secao">
            <h3>üë§ Seu Personagem</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">‚ù§Ô∏è</div>
                    <div class="stat-label">Sa√∫de</div>
                    <div class="stat-value" id="stat-saude">100%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö°</div>
                    <div class="stat-label">Energia</div>
                    <div class="stat-value" id="stat-energia">100%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üçû</div>
                    <div class="stat-label">Comida</div>
                    <div class="stat-value" id="stat-comida">30</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üí∞</div>
                    <div class="stat-label">Ouro</div>
                    <div class="stat-value" id="stat-ouro">50</div>
                </div>
            </div>
            <div style="margin-top:15px;">
                <div class="barra-container">
                    <div class="barra-label"><span>Sa√∫de</span><span id="barra-saude-texto">100%</span></div>
                    <div class="barra-fundo">
                        <div class="barra-preenchimento barra-vida" id="barra-saude" style="width:100%"></div>
                    </div>
                </div>
                <div class="barra-container">
                    <div class="barra-label"><span>Energia</span><span id="barra-energia-texto">100%</span></div>
                    <div class="barra-fundo">
                        <div class="barra-preenchimento barra-energia" id="barra-energia" style="width:100%"></div>
                    </div>
                </div>
                <div class="barra-container">
                    <div class="barra-label"><span>Fome</span><span id="barra-fome-texto">0%</span></div>
                    <div class="barra-fundo">
                        <div class="barra-preenchimento barra-fome" id="barra-fome" style="width:0%"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="secao">
            <h3>üéÆ Modo de A√ß√£o</h3>
            <button class="btn-acao ativo" onclick="jogo.setModo('observar')" id="btn-observar">üëÅÔ∏è Observar</button>
            <button class="btn-acao" onclick="jogo.setModo('mover')" id="btn-mover">üö∂ Mover</button>
            <button class="btn-acao" onclick="jogo.setModo('interagir')" id="btn-interagir">ü§ù Interagir</button>
            <button class="btn-acao btn-perigoso" onclick="jogo.setModo('atacar')" id="btn-atacar">‚öîÔ∏è Atacar</button>
        </div>
        
        <div class="secao">
            <h3>üåç Estado do Mundo</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-label">Popula√ß√£o</div>
                    <div class="stat-value" id="info-pop">40</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üõ°Ô∏è</div>
                    <div class="stat-label">Fac√ß√µes</div>
                    <div class="stat-value" id="info-fac">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ú®</div>
                    <div class="stat-label">Religi√µes</div>
                    <div class="stat-value" id="info-rel">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚öîÔ∏è</div>
                    <div class="stat-label">Guerras</div>
                    <div class="stat-value" id="info-guer">0</div>
                </div>
            </div>
            <div style="margin-top:15px; text-align:center;">
                <span style="color:#888; font-size:11px;">TURNO ATUAL</span>
                <div style="font-family:Orbitron; font-size:24px; color:var(--neon-blue);" id="info-turno">0</div>
            </div>
        </div>
        
        <div class="secao">
            <h3>‚è±Ô∏è Controles de Tempo</h3>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <button class="btn-acao" onclick="jogo.pausar()" id="btn-pausa">‚è∏Ô∏è Pausar</button>
                <button class="btn-acao" onclick="jogo.umTurno()">‚è≠Ô∏è 1 Turno</button>
                <button class="btn-acao" onclick="jogo.acelerar()">‚è© 1x</button>
                <button class="btn-acao" onclick="jogo.resetar()">üîÑ Reset</button>
            </div>
        </div>
        
        <div class="secao">
            <h3>üìú Cr√¥nicas do Mundo</h3>
            <div id="log-eventos">
                <div style="color:#666; font-style:italic; text-align:center; padding:20px;">O universo aguarda suas escolhas...</div>
            </div>
        </div>
    </div>
    
    <div id="area-jogo">
        <div id="barra-superior">
            <div class="indicador">
                <div class="indicador-label">Era C√≥smica</div>
                <div class="indicador-valor" id="ind-era">PRIMORDIAL</div>
            </div>
            <div class="indicador">
                <div class="indicador-label">Turno</div>
                <div class="indicador-valor" id="ind-turno">0</div>
            </div>
            <div class="indicador">
                <div class="indicador-label">Sobreviventes</div>
                <div class="indicador-valor" id="ind-pop">40</div>
            </div>
            <div class="indicador">
                <div class="indicador-label">Eventos</div>
                <div class="indicador-valor" id="ind-eventos" style="color:var(--neon-pink);">0</div>
            </div>
        </div>
        
        <div id="canvas-container">
            <canvas id="gameCanvas" width="700" height="700"></canvas>
            
            <div id="tooltip"></div>
            
            <div id="painel-interacao">
                <div id="painel-titulo">AGENTE</div>
                <div class="acoes-grid">
                    <button class="btn-acao" onclick="jogo.acaoAgente('conversar')">üí¨ Conversar</button>
                    <button class="btn-acao" onclick="jogo.acaoAgente('dar_comida')">üçû Dar Comida</button>
                    <button class="btn-acao" onclick="jogo.acaoAgente('dar_ouro')">üí∞ Dar Ouro</button>
                    <button class="btn-acao" onclick="jogo.acaoAgente('recrutar')">üõ°Ô∏è Recrutar</button>
                    <button class="btn-acao btn-perigoso" onclick="jogo.acaoAgente('atacar')">‚öîÔ∏è Atacar</button>
                    <button class="btn-acao" onclick="jogo.fecharPainel()">‚ùå Fechar</button>
                </div>
            </div>
            
            <div id="legendas">
                <div class="legenda-titulo">PROFISS√ïES</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#44ff44; border-color:#44ff44;"></div> Agricultor üåæ</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#ff4444; border-color:#ff4444;"></div> Guerreiro ‚öîÔ∏è</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#ffaa00; border-color:#ffaa00;"></div> Mercador üí∞</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#4488ff; border-color:#4488ff;"></div> Artes√£o üî®</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#aa44ff; border-color:#aa44ff;"></div> S√°bio üìú</div>
                <div class="legenda-item"><div class="legenda-cor" style="background:#888888; border-color:#888888;"></div> Ladr√£o üó°Ô∏è</div>
                <div style="margin-top:15px; padding-top:15px; border-top:1px solid rgba(255,255,255,0.1);">
                    <div class="legenda-item"><div class="legenda-cor" style="background:#00d4ff; border-color:#00d4ff;"></div> Voc√™ üß≠</div>
                </div>
            </div>
        </div>
    </div>

<script>
// Sistema de Part√≠culas
class Particulas {
    constructor() {
        this.lista = [];
    }
    
    criar(x, y, cor, qtd = 10) {
        for (let i = 0; i < qtd; i++) {
            this.lista.push({
                x: x, y: y,
                vx: (Math.random() - 0.5) * 4,
                vy: (Math.random() - 0.5) * 4,
                vida: 1,
                cor: cor,
                tam: Math.random() * 4 + 2
            });
        }
    }
    
    atualizar() {
        for (let i = this.lista.length - 1; i >= 0; i--) {
            const p = this.lista[i];
            p.x += p.vx;
            p.y += p.vy;
            p.vy += 0.1;
            p.vida -= 0.02;
            if (p.vida <= 0) this.lista.splice(i, 1);
        }
    }
    
    desenhar(ctx) {
        for (const p of this.lista) {
            ctx.globalAlpha = p.vida;
            ctx.fillStyle = p.cor;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.tam, 0, Math.PI * 2);
            ctx.fill();
        }
        ctx.globalAlpha = 1;
    }
}

class Agente {
    constructor(dados) {
        Object.assign(this, dados);
        this.fome = this.fome || 0;
        this.faccao = this.faccao || null;
        this.religiao = this.religiao || null;
        this.humor = this.humor || 'neutro';
        this.idade = this.idade || 20;
        
        this.animX = this.x;
        this.animY = this.y;
        this.escala = 1;
        this.pulso = Math.random() * Math.PI * 2;
        
        this.cores = {
            agricultor: '#44ff44', guerreiro: '#ff4444', mercador: '#ffaa00',
            artesao: '#4488ff', sabio: '#aa44ff', ladrao: '#888888', viajante: '#00d4ff'
        };
        this.icones = {
            agricultor: 'üåæ', guerreiro: '‚öîÔ∏è', mercador: 'üí∞',
            artesao: 'üî®', sabio: 'üìú', ladrao: 'üó°Ô∏è', viajante: 'üß≠'
        };
    }
    
    atualizarAnim() {
        this.animX += (this.x - this.animX) * 0.1;
        this.animY += (this.y - this.animY) * 0.1;
        this.pulso += 0.05;
        
        if (this.humor === 'alegria') this.escala = 1 + Math.sin(this.pulso) * 0.08;
        else if (this.humor === 'raiva') this.escala = 1 + Math.sin(this.pulso * 3) * 0.05;
        else this.escala = 1;
    }
    
    desenhar(ctx, tam, selecionado, tempo) {
        if (!this.vivo) return;
        
        const px = this.animX * tam + tam/2;
        const py = this.animY * tam + tam/2;
        const r = (tam * 0.35) * this.escala;
        
        ctx.save();
        ctx.translate(px, py);
        
        if (selecionado) {
            const grad = ctx.createRadialGradient(0, 0, r, 0, 0, r + 15);
            grad.addColorStop(0, 'rgba(0,212,255,0.6)');
            grad.addColorStop(1, 'rgba(0,212,255,0)');
            ctx.fillStyle = grad;
            ctx.beginPath();
            ctx.arc(0, 0, r + 15, 0, Math.PI * 2);
            ctx.fill();
            
            ctx.strokeStyle = '#00d4ff';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            ctx.beginPath();
            ctx.arc(0, 0, r + 12, tempo * 0.003, tempo * 0.003 + Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        const auras = { alegria: 'rgba(255,221,0,0.4)', raiva: 'rgba(255,0,0,0.4)', medo: 'rgba(136,0,255,0.4)', neutro: 'rgba(136,136,136,0.2)' };
        const gradAura = ctx.createRadialGradient(0, 0, r * 0.5, 0, 0, r + 8);
        gradAura.addColorStop(0, auras[this.humor] || auras.neutro);
        gradAura.addColorStop(1, 'rgba(0,0,0,0)');
        ctx.fillStyle = gradAura;
        ctx.beginPath();
        ctx.arc(0, 0, r + 8, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.fillStyle = 'rgba(0,0,0,0.3)';
        ctx.beginPath();
        ctx.ellipse(0, r + 5, r * 0.8, r * 0.3, 0, 0, Math.PI * 2);
        ctx.fill();
        
        const grad = ctx.createRadialGradient(-r*0.3, -r*0.3, 0, 0, 0, r);
        grad.addColorStop(0, '#ffffff');
        grad.addColorStop(0.3, this.cores[this.profissao]);
        grad.addColorStop(1, this.cores[this.profissao]);
        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(0, 0, r, 0, Math.PI * 2);
        ctx.fill();
        
        ctx.strokeStyle = this.saude > 0.7 ? '#44ff44' : this.saude > 0.4 ? '#ffaa00' : '#ff4444';
        ctx.lineWidth = 3;
        ctx.stroke();
        
        if (this.faccao) {
            ctx.fillStyle = '#ffffff';
            ctx.shadowColor = '#ffffff';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.arc(r*0.7, -r*0.7, 5, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }
        
        if (this.religiao) {
            ctx.fillStyle = '#ffdd00';
            ctx.shadowColor = '#ffdd00';
            ctx.shadowBlur = 10;
            ctx.beginPath();
            ctx.arc(-r*0.7, -r*0.7, 4, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }
        
        ctx.restore();
        
        ctx.font = `bold ${tam * 0.5}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(this.icones[this.profissao] || 'üë§', px, py);
        
        ctx.font = 'bold 11px Rajdhani';
        ctx.shadowColor = 'rgba(0,0,0,0.8)';
        ctx.shadowBlur = 4;
        ctx.fillStyle = '#ffffff';
        ctx.fillText(this.nome, px, py - r - 18);
        ctx.shadowBlur = 0;
        
        ctx.fillStyle = 'rgba(0,0,0,0.5)';
        ctx.fillRect(px - 15, py + r + 8, 30, 4);
        ctx.fillStyle = this.saude > 0.7 ? '#44ff44' : this.saude > 0.4 ? '#ffaa00' : '#ff4444';
        ctx.fillRect(px - 15, py + r + 8, 30 * this.saude, 4);
    }
}

class Jogo {
    constructor() {
        this.canvas = document.getElementById('gameCanvas');
        this.ctx = this.canvas.getContext('2d');
        this.grid = 20;
        this.tam = 35;
        this.agentes = [];
        this.jogador = null;
        this.sel = null;
        this.modo = 'observar';
        this.turno = 0;
        this.pausado = false;
        this.vel = 1;
        this.faccoes = [];
        this.religioes = [];
        this.guerras = [];
        this.particulas = new Particulas();
        this.tempo = 0;
        this.era = 'PRIMORDIAL';
        
        this.biomas = this.gerarBiomas();
        this.gerarAgentes(35);
        this.setupEventos();
        this.loop();
    }
    
    gerarBiomas() {
        const b = [];
        for (let y = 0; y < this.grid; y++) {
            for (let x = 0; x < this.grid; x++) {
                let tipo = 'planicie', cor = '#3d5c3d';
                if (x < 10 && y < 10) { tipo = 'floresta'; cor = '#2d5016'; }
                else if (x >= 10 && y < 10) { tipo = 'deserto'; cor = '#c2b280'; }
                else if (x < 10 && y >= 10) { tipo = 'montanha'; cor = '#4a4a4a'; }
                b.push({x, y, tipo, cor});
            }
        }
        return b;
    }
    
    gerarAgentes(qtd) {
        const nomes = ['Aria','Kael','Mira','Thorn','Luna','Sol','Nyx','Orion','Vesper','Dawn','Ash','Ember','River','Stone','Sky','Flame','Shadow','Light','Storm','Calm','Zephyr','Frost','Iron','Gold','Silver','Copper','Lead','Mercury','Sulfur','Salt','Echo','Silence','Noise','Music','Rhythm','Blues','Jazz','Rock','Pop','Folk'];
        const profs = ['agricultor','guerreiro','mercador','artesao','sabio','ladrao'];
        
        for (let i = 0; i < qtd; i++) {
            const x = Math.floor(Math.random() * this.grid);
            const y = Math.floor(Math.random() * this.grid);
            const bio = this.biomas.find(b => b.x === x && b.y === y);
            
            let p = profs[Math.floor(Math.random() * profs.length)];
            if (bio.tipo === 'floresta' && Math.random() < 0.6) p = 'agricultor';
            else if (bio.tipo === 'deserto' && Math.random() < 0.5) p = Math.random() < 0.5 ? 'mercador' : 'guerreiro';
            else if (bio.tipo === 'montanha' && Math.random() < 0.5) p = Math.random() < 0.5 ? 'artesao' : 'guerreiro';
            
            this.agentes.push(new Agente({
                id: `NPC_${i}`, nome: nomes[i % nomes.length], x, y,
                profissao: p, bioma: bio.tipo, vivo: true,
                saude: 0.7 + Math.random() * 0.3,
                energia: 0.6 + Math.random() * 0.4,
                fome: Math.random() * 0.3,
                humor: ['alegria','raiva','medo','neutro'][Math.floor(Math.random() * 4)],
                idade: 18 + Math.floor(Math.random() * 40)
            }));
        }
        
        this.jogador = new Agente({
            id: 'JOGADOR', nome: 'Voc√™', x: 10, y: 10,
            profissao: 'viajante', bioma: 'planicie',
            vivo: true, saude: 1, energia: 1, fome: 0,
            humor: 'curiosidade', idade: 25
        });
        this.agentes.push(this.jogador);
        this.atualizarUI();
    }
    
    setupEventos() {
        this.canvas.addEventListener('click', (e) => {
            const rect = this.canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / this.tam);
            const y = Math.floor((e.clientY - rect.top) / this.tam);
            
            if (this.modo === 'mover') {
                this.jogador.x = x;
                this.jogador.y = y;
                return;
            }
            
            const ag = this.agentes.find(a => a.vivo && a.x === x && a.y === y);
            if (ag && ag.id !== 'JOGADOR') {
                if (this.modo === 'atacar') this.atacar(ag);
                else this.selecionar(ag);
            }
        });
        
        this.canvas.addEventListener('mousemove', (e) => {
            const rect = this.canvas.getBoundingClientRect();
            const x = Math.floor((e.clientX - rect.left) / this.tam);
            const y = Math.floor((e.clientY - rect.top) / this.tam);
            
            const ag = this.agentes.find(a => a.vivo && a.x === x && a.y === y);
            const tt = document.getElementById('tooltip');
            
            if (ag) {
                tt.style.display = 'block';
                tt.style.left = (e.clientX + 15) + 'px';
                tt.style.top = (e.clientY + 15) + 'px';
                const bio = this.biomas.find(b => b.x === ag.x && b.y === ag.y);
                tt.innerHTML = `
                    <strong style="color:#00d4ff; font-size:16px;">${ag.icones[ag.profissao]} ${ag.nome}</strong><br>
                    <span style="color:#888;">Prof:</span> <span style="color:${ag.cores[ag.profissao]}">${ag.profissao}</span><br>
                    <span style="color:#888;">Bioma:</span> ${bio ? bio.tipo : '?' }<br>
                    <span style="color:#888;">Sa√∫de:</span> <span style="color:${ag.saude > 0.7 ? '#44ff44' : ag.saude > 0.4 ? '#ffaa00' : '#ff4444'}">${Math.floor(ag.saude * 100)}%</span><br>
                    <span style="color:#888;">Humor:</span> ${ag.humor}<br>
                    <span style="color:#888;">Idade:</span> ${Math.floor(ag.idade)}<br>
                    ${ag.faccao ? `<span style="color:#888;">Fac√ß√£o:</span> ${ag.faccao}<br>` : ''}
                    ${ag.religiao ? `<span style="color:#888;">Religi√£o:</span> <span style="color:#ffdd00">${ag.religiao}</span>` : ''}
                `;
            } else {
                tt.style.display = 'none';
            }
        });
    }
    
    loop() {
        this.tempo += 16;
        
        for (const a of this.agentes) if (a.vivo) a.atualizarAnim();
        this.particulas.atualizar();
        
        if (!this.pausado && this.tempo % Math.floor(1000 / this.vel) < 16) {
            this.simular();
        }
        
        this.desenhar();
        requestAnimationFrame(() => this.loop());
    }
    
    desenhar() {
        const grad = this.ctx.createRadialGradient(350, 350, 0, 350, 350, 350);
        grad.addColorStop(0, '#0a0a15');
        grad.addColorStop(1, '#050508');
        this.ctx.fillStyle = grad;
        this.ctx.fillRect(0, 0, 700, 700);
        
        for (const b of this.biomas) {
            this.ctx.fillStyle = b.cor;
            this.ctx.globalAlpha = 0.3;
            this.ctx.fillRect(b.x * this.tam, b.y * this.tam, this.tam, this.tam);
        }
        this.ctx.globalAlpha = 1;
        
        this.ctx.strokeStyle = 'rgba(0,212,255,0.05)';
        for (let i = 0; i <= this.grid; i++) {
            this.ctx.beginPath();
            this.ctx.moveTo(i * this.tam, 0);
            this.ctx.lineTo(i * this.tam, 700);
            this.ctx.stroke();
            this.ctx.beginPath();
            this.ctx.moveTo(0, i * this.tam);
            this.ctx.lineTo(700, i * this.tam);
            this.ctx.stroke();
        }
        
        this.particulas.desenhar(this.ctx);
        
        const ordenados = [...this.agentes].sort((a, b) => a.animY - b.animY);
        for (const a of ordenados) {
            a.desenhar(this.ctx, this.tam, a === this.jogador, this.tempo);
        }
    }
    
    simular() {
        this.turno++;
        let evt = 0;
        
        if (this.turno === 100) this.era = 'DESPERTAR';
        else if (this.turno === 300) this.era = 'CONQUISTA';
        else if (this.turno === 600) this.era = 'ILUMINA√á√ÉO';
        document.getElementById('ind-era').textContent = this.era;
        
        for (const a of this.agentes) {
            if (!a.vivo || a.id === 'JOGADOR') continue;
            
            if (Math.random() < 0.3) {
                let dx = Math.floor(Math.random() * 3) - 1;
                let dy = Math.floor(Math.random() * 3) - 1;
                
                if (a.profissao === 'guerreiro' && a.humor === 'raiva') {
                    const inim = this.agentes.find(x => x.vivo && x.id !== a.id && x.faccao && x.faccao !== a.faccao);
                    if (inim) { dx = Math.sign(inim.x - a.x); dy = Math.sign(inim.y - a.y); }
                }
                
                const nx = Math.max(0, Math.min(this.grid - 1, a.x + dx));
                const ny = Math.max(0, Math.min(this.grid - 1, a.y + dy));
                
                if (nx !== a.x || ny !== a.y) {
                    a.x = nx; a.y = ny;
                    const nb = this.biomas.find(b => b.x === a.x && b.y === a.y);
                    if (nb) a.bioma = nb.tipo;
                }
            }
            
            if (a.fome > 0.8) a.humor = 'medo';
            else if (Math.random() < 0.05) {
                a.humor = ['alegria','raiva','medo','neutro'][Math.floor(Math.random() * 4)];
            }
            
            a.fome += 0.015;
            a.energia -= 0.008;
            if (a.fome > 0.7) a.saude -= 0.015;
            if (a.energia < 0.2) a.saude -= 0.01;
            a.idade += 0.001;
            
            if (a.saude <= 0 || a.idade > 80) {
                a.vivo = false;
                const px = a.x * this.tam + this.tam/2;
                const py = a.y * this.tam + this.tam/2;
                this.particulas.criar(px, py, '#ff4444', 20);
                this.log('morte', `${a.nome} (${a.profissao}) faleceu aos ${Math.floor(a.idade)} anos.`);
                evt++;
            }
            
            if (!a.faccao && Math.random() < 0.015) {
                const al = this.agentes.find(x => x.vivo && x.id !== a.id && !x.faccao && Math.abs(x.x - a.x) <= 2 && Math.abs(x.y - a.y) <= 2 && x.humor === a.humor);
                if (al) {
                    const nf = `Ordem_${['Dourada','Sombria','Eterna','Radiante'][Math.floor(Math.random()*4)]}`;
                    a.faccao = nf; al.faccao = nf;
                    this.faccoes.push(nf);
                    const px = a.x * this.tam + this.tam/2;
                    const py = a.y * this.tam + this.tam/2;
                    this.particulas.criar(px, py, '#00d4ff', 15);
                    this.log('social', `üèõÔ∏è ${nf} fundada por ${a.nome} e ${al.nome}!`);
                    evt++;
                }
            }
            
            if (Math.random() < 0.003 && !a.religiao) {
                const deuses = ['Sol','Lua','Terra','Fogo','√Ågua','Vento','Tempo'];
                const d = deuses[Math.floor(Math.random() * deuses.length)];
                a.religiao = d;
                if (!this.religioes.includes(d)) {
                    this.religioes.push(d);
                    const px = a.x * this.tam + this.tam/2;
                    const py = a.y * this.tam + this.tam/2;
                    this.particulas.criar(px, py, '#ffdd00', 25);
                    this.log('religiao', `‚ú® ${a.nome} teve vis√£o de ${d}! Nova religi√£o!`);
                    evt++;
                }
            }
            
            if (a.faccao && Math.random() < 0.01) {
                const ini = this.agentes.find(x => x.vivo && x.id !== a.id && x.faccao && x.faccao !== a.faccao && Math.abs(x.x - a.x) <= 1 && Math.abs(x.y - a.y) <= 1);
                if (ini) {
                    ini.saude -= 0.2;
                    ini.humor = 'raiva';
                    a.humor = 'raiva';
                    const px = ini.x * this.tam + this.tam/2;
                    const py = ini.y * this.tam + this.tam/2;
                    this.particulas.criar(px, py, '#ff4444', 10);
                    if (!this.guerras.find(g => g.f1 === a.faccao && g.f2 === ini.faccao)) {
                        this.guerras.push({ f1: a.faccao, f2: ini.faccao, turno: this.turno });
                        this.log('guerra', `‚öîÔ∏è Conflito: ${a.faccao} vs ${ini.faccao}!`);
                        evt++;
                    }
                }
            }
        }
        
        if (Math.random() < 0.02) {
            const evts = [
                'üåæ Colheita abundante!',
                '‚òÄÔ∏è O Sol brilha intensamente!',
                'üåë Eclipse! Temor nas religi√µes!',
                'üí∞ Comerciantes distribuem ouro!',
                '‚öîÔ∏è Torneio de guerreiros!'
            ];
            this.log('economia', evts[Math.floor(Math.random() * evts.length)]);
            evt++;
        }
        
        this.atualizarUI();
        document.getElementById('ind-eventos').textContent = evt;
    }
    
    log(tipo, msg) {
        const log = document.getElementById('log-eventos');
        const div = document.createElement('div');
        div.className = `evento evento-${tipo}`;
        div.innerHTML = `<strong>[T${this.turno}]</strong> ${msg}`;
        log.insertBefore(div, log.firstChild);
        if (log.children.length > 20) log.removeChild(log.lastChild);
    }
    
    atualizarUI() {
        const vivos = this.agentes.filter(a => a.vivo).length;
        document.getElementById('info-pop').textContent = vivos;
        document.getElementById('info-fac').textContent = new Set(this.agentes.map(a => a.faccao).filter(f => f)).size;
        document.getElementById('info-rel').textContent = this.religioes.length;
        document.getElementById('info-guer').textContent = this.guerras.length;
        document.getElementById('info-turno').textContent = this.turno;
        document.getElementById('ind-turno').textContent = this.turno;
        document.getElementById('ind-pop').textContent = vivos;
        
        if (this.jogador) {
            document.getElementById('stat-saude').textContent = Math.floor(this.jogador.saude * 100) + '%';
            document.getElementById('stat-energia').textContent = Math.floor(this.jogador.energia * 100) + '%';
            document.getElementById('barra-saude').style.width = (this.jogador.saude * 100) + '%';
            document.getElementById('barra-energia').style.width = (this.jogador.energia * 100) + '%';
            document.getElementById('barra-fome').style.width = (this.jogador.fome * 100) + '%';
        }
    }
    
    setModo(m) {
        this.modo = m;
        document.querySelectorAll('.btn-acao').forEach(b => b.classList.remove('ativo'));
        document.getElementById(`btn-${m}`).classList.add('ativo');
    }
    
    pausar() {
        this.pausado = !this.pausado;
        document.getElementById('btn-pausa').innerHTML = this.pausado ? '‚ñ∂Ô∏è Continuar' : '‚è∏Ô∏è Pausar';
    }
    
    umTurno() {
        const p = this.pausado;
        this.pausado = false;
        this.simular();
        this.pausado = p;
    }
    
    acelerar() {
        this.vel = this.vel === 1 ? 2 : this.vel === 2 ? 5 : 1;
        event.target.innerHTML = `‚è© ${this.vel}x`;
    }
    
    resetar() {
        this.agentes = [];
        this.faccoes = [];
        this.religioes = [];
        this.guerras = [];
        this.turno = 0;
        this.era = 'PRIMORDIAL';
        this.pausado = false;
        document.getElementById('log-eventos').innerHTML = '<div style="color:#666; font-style:italic; text-align:center; padding:20px;">Mundo reiniciado...</div>';
        this.gerarAgentes(35);
    }
    
    selecionar(ag) {
        this.sel = ag;
        document.getElementById('painel-titulo').innerHTML = `${ag.icones[ag.profissao]} ${ag.nome}`;
        document.getElementById('painel-interacao').style.display = 'flex';
    }
    
    fecharPainel() {
        document.getElementById('painel-interacao').style.display = 'none';
        this.sel = null;
    }
    
    acaoAgente(acao) {
        if (!this.sel) return;
        const alvo = this.sel;
        
        switch(acao) {
            case 'conversar':
                alvo.humor = 'alegria';
                this.log('social', `Voc√™ conversou com ${alvo.nome}.`);
                break;
            case 'dar_comida':
                alvo.fome = Math.max(0, alvo.fome - 0.3);
                alvo.humor = 'alegria';
                this.log('social', `Voc√™ deu comida para ${alvo.nome}.`);
                break;
            case 'dar_ouro':
                alvo.humor = 'curiosidade';
                this.log('economia', `Voc√™ deu ouro para ${alvo.nome}.`);
                break;
            case 'recrutar':
                if (!alvo.faccao && !this.jogador.faccao) {
                    const nf = `Ordem_de_${this.jogador.nome}`;
                    this.jogador.faccao = nf;
                    alvo.faccao = nf;
                    this.faccoes.push(nf);
                    this.log('social', `${alvo.nome} se juntou √† ${nf}!`);
                } else if (this.jogador.faccao && !alvo.faccao) {
                    alvo.faccao = this.jogador.faccao;
                    this.log('social', `${alvo.nome} se juntou √† sua fac√ß√£o!`);
                }
                break;
            case 'atacar':
                this.atacar(alvo);
                return;
        }
        
        this.fecharPainel();
        this.atualizarUI();
    }
    
    atacar(alvo) {
        alvo.saude -= 0.4;
        alvo.humor = 'raiva';
        
        const px = alvo.x * this.tam + this.tam/2;
        const py = alvo.y * this.tam + this.tam/2;
        this.particulas.criar(px, py, '#ff4444', 15);
        
        this.log('guerra', `Voc√™ atacou ${alvo.nome}!`);
        
        if (alvo.saude <= 0) {
            alvo.vivo = false;
            this.particulas.criar(px, py, '#ff0000', 30);
            this.log('morte', `${alvo.nome} foi morto por voc√™!`);
            
            const amigos = this.agentes.filter(a => a.vivo && a.faccao === alvo.faccao && a.id !== alvo.id);
            for (const a of amigos) a.humor = 'raiva';
            if (amigos.length > 0) this.log('guerra', `Aliados de ${alvo.nome} est√£o furiosos!`);
        }
        
        this.fecharPainel();
        this.atualizarUI();
    }
}

const jogo = new Jogo();
</script>
</body>
</html>
